apiVersion: v1
kind: Namespace
metadata:
  name: frontend
  labels:
    project: upbank-lab
    environment: prod
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: upbank-ui-runtime-config
  namespace: frontend
data:
  runtime-config.json: |
    {
      "cognitoDomain" : "https://upbank-prod.auth.ap-southeast-2.amazoncognito.com",
      "clientId" : "13sk8uejgh9ha4b9gn28ahkt9f",
      "appSyncUrl" : "https://api.upbank-lab.alanlima.cloud/graphql",
      "region" : "ap-southeast-2",
      "scopes" : "openid email profile",
      "logoutUri" : "https://upbank-lab.alanlima.cloud/logout",
      "redirectUri" : "https://upbank-lab.alanlima.cloud/callback"
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: upbank-ui
  namespace: frontend
  labels:
    project: upbank-lab
    app: upbank-ui
    environment: prod
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  selector:
    matchLabels:
      app: upbank-ui
  template:
    metadata:
      labels:
        project: upbank-lab
        app: upbank-ui
        environment: prod
    spec:
      containers:
        - name: app
          image: alanrlima/awslab-upbank-ui:777a78f58517bb347a39a45e4d8c1896a0124a9b
          resources:
            limits:
              memory: "256Mi"
              cpu: "500m"
            requests:
              memory: "128Mi"
              cpu: "250m"
          ports:
            - containerPort: 80
          volumeMounts:
            - name: runtime-config
              mountPath: /usr/share/nginx/html/config/runtime-config.json
              subPath: runtime-config.json
      volumes:
        - name: runtime-config
          configMap:
            name: upbank-ui-runtime-config
